"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.handle = handle;

require("#polyfill");

var _ufo = require("ufo");

var _server = require("../server");

async function handle(context, req) {
  let url;

  if (req.headers["x-ms-original-url"]) {
    url = (0, _ufo.parseURL)(req.headers["x-ms-original-url"]).pathname;
  } else {
    url = "/api/" + (req.params.url || "");
  }

  const {
    body,
    status,
    statusText,
    headers
  } = await (0, _server.localCall)({
    url,
    headers: req.headers,
    method: req.method,
    body: req.body
  });
  context.res = {
    status,
    headers,
    body: body ? body.toString() : statusText
  };
}